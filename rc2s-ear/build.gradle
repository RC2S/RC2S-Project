import org.apache.tools.ant.taskdefs.condition.Os
apply plugin: 'ear'

dependencies {
    deploy project(':rc2s-ejb')
    earlib project(path: ':rc2s-ejb', configuration: 'compile')
}

ear {
    appDirName 'META-INF/'
    libDirName 'APP-INF/lib'
    deploymentDescriptor {
        applicationName = "RC2S Server"
        initializeInOrder = true
        displayName = "RC2S Server"
        description = "JEE Server for RC2S project"
    }
	
	doLast {
		tasks.autodeploy.execute();
	}
}

task autodeploy(type: Exec) {
	if(Os.isFamily(Os.FAMILY_WINDOWS)) {
        executable "D:\\Programmes\\payara41\\bin\\asadmin.bat"
	}
	else {
		executable "asadmin"
	}
	args "--user", "admin", "deploy", "--force=true", "--type", "ear", "--name", "rc2s", "$buildDir/libs/rc2s-ear-${version}.ear"
}